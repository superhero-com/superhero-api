name: Production deploy (multi-server)
on:
  workflow_dispatch:
    inputs:
      VERSION:
        description: "Version to deploy to production"
        default: "latest"
        required: false
        type: string
  workflow_call:
    inputs:
      VERSION:
        description: "Version to deploy to production"
        default: "main"
        required: false
        type: string
jobs:
  deploy_wordcraft:
    name: Deploy production (wordcraft)
    uses: ./.github/workflows/ssh_deploy.yaml
    with:
      VERSION: ${{ inputs.VERSION }}
      CONTAINER_NAME: "production-wordcraft-api"
    secrets:
      AE_NETWORK_ID: "ae_mainnet"
      API_HOST_PORT: "3033"
      DB_DATABASE: "api"
      DEPLOY_HOST: "api.wordcraft.fun"
      DEPLOY_KEY: ${{ secrets.PROD_DEPLOY_KEY }}
      DEPLOY_USERNAME: ${{ secrets.PROD_DEPLOY_USERNAME }}
      DB_USER: ${{ secrets.PROD_DB_USER }}
      DB_PASSWORD: ${{ secrets.PROD_DB_PASSWORD }}
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
      DOCKERHUB_REPO: ${{ secrets.DOCKERHUB_REPO }}
  # Uncomment when ready to deploy to trendminer production
  # deploy_trendminer:
  #   name: Deploy production (trendminer)
  #   uses: ./.github/workflows/ssh_deploy.yaml
  #   with:
  #     VERSION: ${{ inputs.VERSION }}
  #     CONTAINER_NAME: "production-trendminer-api"
  #   secrets:
  #     AE_NETWORK_ID: "ae_mainnet"
  #     API_HOST_PORT: "3033"
  #     DB_DATABASE: "api"
  #     DEPLOY_HOST: "api.trendminer.fun"
  #     DEPLOY_KEY: ${{ secrets.PROD_TRENDMINERFUN_DEPLOY_KEY }}
  #     DEPLOY_USERNAME: ${{ secrets.PROD_DEPLOY_USERNAME }}
  #     DB_USER: ${{ secrets.PROD_DB_USER }}
  #     DB_PASSWORD: ${{ secrets.PROD_DB_PASSWORD }}
  #     DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
  #     DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
  #     DOCKERHUB_REPO: ${{ secrets.DOCKERHUB_REPO }}
